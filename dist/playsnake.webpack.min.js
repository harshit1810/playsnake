!function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e){((t={arenaHeight:500,arenaWidth:500})=>{if(!window)return;const e={default:"Sorry.",startGame:"Sorry. Unable To Start The Game"},i=window,r=i.document,n=r.body,[o,s]=["http://www.w3.org/2000/svg","px"],a=function(t){return String(t).trim().concat(this)}.bind(s),h={id:"play-snake-arena",width:t.arenaWidth,height:t.arenaHeight,borderColor:"black",borderWidth:1,limits:{x:t.arenaWidth-1,y:t.arenaHeight-1},supportedKeys:[37,38,39,40],keyConfig:{37:{reverse:39},38:{reverse:40},39:{reverse:37},40:{reverse:38}}},d=function(){try{let t=r.createElementNS(o,"svg");t.setAttribute("id",h.id),t.setAttribute("height",h.height),t.setAttribute("width",h.width),t.style.border=a(h.borderWidth)+" solid "+h.borderColor,n.appendChild(t);let e=r.createElement("div");return e.innerHTML='Your Score: <span id="score" style="font-weight: bold;">0</span>',n.appendChild(e),t}catch(t){return!1}}();if(!d)return showAlert("Sorry. Unable to start the game.");let l=n.querySelector("#score");class c{constructor(t,e=[]){this.observers=e,this.topic=t}addObserver(t){t.element&&void 0!==t.element.id&&this.observers.push(t)}removeObserver(t){this.observers.splice(this.observers.findIndex(e=>e.element.id===t.element.id),1)}notify(){this.observers.forEach(t=>{t[this.topic]()})}}const u=new class extends c{constructor(){super("nextXY")}notify(t){super.notify(),t&&1==t&&v.grow(K.drop)}},y={log:console.log,error:console.error};let f;const A=function(t){return{SNAKE:{id:t.snakeId,elemType:"rect",width:t.snakeSize,color:t.primaryColor,partGap:0,length:t.snakeLength,speed:100*t.snakeSpeed,directionMap:{37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN"}},SNAKE_PART:{idPrefix:t.snakeId+"-part"},SNAKE_FOOD:{id:t.snakeFoodId,elemType:"circle",color:t.secondaryColor,size:Math.floor(t.snakeSize/3),startAfter:2},SNAKE_FOOD_BONUS:{color:t.alertColor,size:a(2*t.snakeSize)},ARENA:{center:{x:Math.floor(Math.floor(d.getAttribute("width"))/2),y:Math.floor(Math.floor(d.getAttribute("height"))/2)}}}}({snakeId:"the-snake",snakeFoodId:"the-snake-food",snakeSpeed:5,primaryColor:"black",secondaryColor:"grey",alertColor:"red",snakeLength:1,snakeSize:15});let x=39;const g=function(t){let e=[];return t&&e.push(t),{add:function(t){let i=e[e.length-1];i&&i.position.x==t.position.x&&i.position.y==t.position.y?i.direction=t.direction:e.push(t)},getFirst:function(){return e[0]},remove:function(){e.shift()},clear:function(){e.splice(0,e.length)},hasCommands:function(){return e.length>0},getNextTurn:function(t){if(void 0===p[t])return this.getFirst();let i=e.findIndex(e=>e.id===p[t]);return i==e.length-1?void 0:e[i+1]}}}({id:Date.now(),direction:x,position:{x:A.ARENA.center.x,y:A.ARENA.center.y}}),p={};function b(t){f=setInterval(()=>{let t=x;v.changeDirection(t),v.start()},t)}function m(){v=null,i.clearInterval(f)}function S(){K=null}class N{constructor(t,e,i,r,n=A.SNAKE.color){this.head=new w(t,e,i,r,n),this.tail=this.head,this.arena=t,this.UP=function(){this.move(0,-1*A.SNAKE.width)},this.DOWN=function(){this.move(0,A.SNAKE.width)},this.RIGHT=function(){this.move(A.SNAKE.width,0)},this.LEFT=function(){this.move(-1*A.SNAKE.width,0)},this.turningPoints=[],this.length=1}changeDirection(t){this.head.direction=t}grow(t){let{x:e,y:i}=this.tail.getXYOfNextPart(),r=new w(v.arena,e,i,this.tail.direction,this.tail.color);this.tail.next=r,r.prev=this.tail,this.tail=r,this.length+=1,u.addObserver(this.tail),l.innerHTML=+l.innerHTML+10,"function"==typeof t&&t()}changeColor(t){let e=this.head;for(;null!==e.next;)i(e,t),e=e.next;function i(t,e){setTimeout(()=>{t.color=e},0)}}start(){this[A.SNAKE.directionMap[String(this.head.direction)]]()}isEatingFood(){let t=this.head;return t.x<K.x&&K.x<t.x2&&t.y<K.y&&K.y<t.y2&&(K.hide(),!0)}move(t,e){let i=this.head,[r,n]=[i.x,i.y],{x:o,y:s}=w.checkBoundaryPosition(i.direction,{x:r+t,y:n+e});i.x=o,i.y=s;let a=this.isEatingFood();this.moveAllParts(a)}moveAllParts(t){1===this.length&&g.clear(),u.notify(t)}}class w{constructor(t,e,i,n,s){let h=v.length;this.id=void 0!==h?A.SNAKE.id+"-part"+(v.length+1):A.SNAKE.id,this.direction=n,this.element=(()=>{let n=r.createElementNS(o,A.SNAKE.elemType);return n.setAttribute("id",this.id),n.setAttribute("tabIndex",h),n.setAttribute("x",e),n.setAttribute("y",i),n.setAttribute("fill",s),n.setAttribute("width",a(A.SNAKE.width)),n.setAttribute("height",a(A.SNAKE.width)),t.appendChild(n),n})(),this.color=s,this.next=null,this.prev=null}isSnakeHead(){return this.id===A.SNAKE.id}get x(){return parseInt(this.element.getAttribute("x"))}set x(t){this.element.setAttribute("x",Math.floor(t))}get y(){return parseInt(this.element.getAttribute("y"))}set y(t){this.element.setAttribute("y",Math.floor(t))}get x2(){return this.x+(A.SNAKE.width-1)}get y2(){return this.y+(A.SNAKE.width-1)}isTail(){return this.id===v.tail.id}nextXY(){let t={x:this.x,y:this.y};switch(this.direction){case 37:t.x-=A.SNAKE.width;break;case 38:t.y-=A.SNAKE.width;break;case 39:t.x+=A.SNAKE.width;break;case 40:t.y+=A.SNAKE.width}if(t=w.checkBoundaryPosition(this.direction,t),this.x=t.x,this.y=t.y,g.hasCommands()){let t=g.getNextTurn(this.id);t&&t.position.x==this.x&&t.position.y==this.y&&(this.direction=t.direction,p[this.id]=t.id,this.isTail()&&g.remove())}}getXYOfNextPart(){let[t,e]=[this.x,this.y];switch(this.direction){case 37:t+=A.SNAKE.width;break;case 38:e+=A.SNAKE.width;break;case 39:t-=A.SNAKE.width;break;case 40:e-=A.SNAKE.width}return{x:t,y:e}}static checkBoundaryPosition(t,e){switch(t){case 37:e.x<h.borderWidth&&(e.x=h.limits.x-A.SNAKE.width);break;case 38:e.y<h.borderWidth&&(e.y=h.limits.y-A.SNAKE.width);break;case 39:e.x+A.SNAKE.width>h.limits.x&&(e.x=h.borderWidth);break;case 40:e.y+A.SNAKE.width>h.limits.y&&(e.y=h.borderWidth)}return e}}class E{constructor(t,e,i,n=A.SNAKE_FOOD.color,s=A.SNAKE_FOOD.size){K instanceof E||(this.element=(()=>{let t=r.createElementNS(o,A.SNAKE_FOOD.elemType);return t.setAttribute("cx",e),t.setAttribute("cy",i),t.setAttribute("r",s),t.setAttribute("fill",n),d.insertBefore(t,v.head.element),t})(),this.arena=t,[this.x2,this.y2]=[e+(A.SNAKE_FOOD.size-1),i+(A.SNAKE_FOOD.size-1)])}get x(){return parseInt(this.element.getAttribute("cx"))}set x(t){this.element.setAttribute("cx",Math.floor(t))}get y(){return parseInt(this.element.getAttribute("cy"))}set y(t){this.element.setAttribute("cy",Math.floor(t))}static getNextFoodPosition(){function t(){return Math.floor(Math.random()*(h.limits.x-A.SNAKE_FOOD.size))+h.borderWidth+1}function e(){return Math.floor(Math.random()*(h.limits.y-A.SNAKE_FOOD.size))+h.borderWidth+1}return new Promise(function(r,n){let o,[s,a]=[t(),e()];o=setInterval(function(r,h,d){try{s%r==0&&a%r==0?(i.clearInterval(o),h({x:s+2,y:a+2})):[s,a]=[t(),e()]}catch(t){n(t)}},0,A.SNAKE.width,r,n)})}drop(){K instanceof E&&E.getNextFoodPosition().then(t=>{K.x=t.x,K.y=t.y})}hide(){this.x=-1,this.y=-1}}let v=function(){let t;return{get:()=>new Promise(function(e,i){try{if(t instanceof N)return e(t);t=function(){let t=g.getFirst();return new N(d,t.position.x,t.position.y,t.direction,A.SNAKE.color)}(),y.log("snake created"),e(t)}catch(t){i(t)}})}}(),K=function(){let t;return{get:()=>new Promise(function(e,i){try{if(t instanceof E)return e(t);new Promise(function(t,e){E.getNextFoodPosition().then(e=>{t(new E(v.arena,e.x,e.y,A.SNAKE_FOOD.color,A.SNAKE_FOOD.size))},t=>{e(t)})}).then(i=>{t=i,y.log("snake food created"),setTimeout(e,1e3*A.SNAKE_FOOD.startAfter,t),e(t)},t=>{y.error(t)})}catch(t){i(t)}})}}();v.get().then(t=>(v=t,K.get()),t=>Promise.reject(t)).then(t=>(K=t,new Promise(function(t,e){try{i.addEventListener("unload",()=>{m(),S()}),r.addEventListener("keydown",function(t){-1!==h.supportedKeys.indexOf(t.keyCode)&&x!=t.keyCode&&t.keyCode!=h.keyConfig[String(x)].reverse&&(x=t.keyCode,g.add({id:Date.now(),direction:t.keyCode,position:{x:v.head.x,y:v.head.y}}))}),t(!0)}catch(t){e(t)}})),t=>Promise.reject(t)).then(t=>{b(A.SNAKE.speed)},t=>{m(),S(),showAlert(e.startGame)})})()}]);