(()=>{"use strict";function e(){return{setupGame:function(e){var t,n,r,i={FlexCols:{display:"flex","flex-direction":"row"},CapitalizeText:{"text-transform":"capitalize"},ZeroPixels:e.pixelify(0),Padding:e.pixelify(5)},a=e.getConfig(),o=Object.keys(a.directionMap).reduce((function(e,t){return e[a.directionMap[t]]=t,e}),{UP:null,DOWN:null,RIGHT:null,LEFT:null});try{var s=((r=document.getElementById(a.pauseButton.id)).addEventListener("click",(function(){e.getGameEvents().emit("PAUSE_BUTTON_CLICKED")})),r),u=function(){var t=document.getElementById(a.resumeButton.id);return t.addEventListener("click",(function(){e.getGameEvents().emit("RESUME_BUTTON_CLICKED")})),t}();!function(){var t=document.getElementById("legend-container");try{var n=a.eatables,r=void 0===n?{}:n;Object.keys(r).forEach((function(n){var a=r[n],o=a.description,s=a.showInLegend,u=a.color,d=void 0===u?"white":u;if(s&&o){var c=e.createHTMLElement({parent:t,elementType:"div",attributes:{style:e.getStyleString(Object.assign({},i.FlexCols,{"margin-bottom":e.pixelify(5),"align-items":"center",border:"".concat(e.pixelify(1)," solid grey"),padding:i.Padding+" "+i.Padding}))}});e.createHTMLElement({parent:c,elementType:"div",attributes:{style:e.getStyleString({height:e.pixelify(10),width:e.pixelify(10),"background-color":d,"border-radius":e.pixelify(5)})}}),e.createHTMLElement({parent:c,elementType:"span",innerHTML:o,attributes:{style:e.getStyleString(Object.assign({},i.CapitalizeText,{padding:"".concat(i.ZeroPixels," ").concat(e.pixelify(2))}))}})}}))}catch(t){e.LOGGER.warn("Failed while drawing legend: ".concat(t))}}();var d=document.getElementById("score");return(n=document.getElementById("arena-section")).addEventListener("touchstart",(function(e){if(e.preventDefault(),!(e.touches&&e.touches.length>1)){var n={};e.targetTouches&&(n.x=e.targetTouches[0].clientX,n.y=e.targetTouches[0].clientY),t=n}}),!0),n.addEventListener("touchmove",(function(e){e.preventDefault()}),!0),n.addEventListener("touchend",(function(n){n.preventDefault();var r=[parseInt(t.x),parseInt(t.y)],i=r[0],a=r[1];t=null;var s=n.changedTouches[0],u=[parseInt(s.clientX),parseInt(s.clientY)],d=u[0],c=u[1];if(i!==d||a!==c){var l=d-i,g=c-a;if(Math.abs(l)!==Math.abs(g))return 0===l?g>0?void e.getGameEvents().emit("SNAKE_DIRECTION_CHANGE",{direction:o.DOWN}):void e.getGameEvents().emit("SNAKE_DIRECTION_CHANGE",{direction:o.UP}):0===g?l>0?void e.getGameEvents().emit("SNAKE_DIRECTION_CHANGE",{direction:o.RIGHT}):void e.getGameEvents().emit("SNAKE_DIRECTION_CHANGE",{direction:o.LEFT}):void(l>0&&Math.abs(l)>Math.abs(g)?e.getGameEvents().emit("SNAKE_DIRECTION_CHANGE",{direction:o.RIGHT}):l<0&&Math.abs(l)>Math.abs(g)?e.getGameEvents().emit("SNAKE_DIRECTION_CHANGE",{direction:o.LEFT}):g>0&&Math.abs(g)>Math.abs(l)?e.getGameEvents().emit("SNAKE_DIRECTION_CHANGE",{direction:o.DOWN}):g<0&&Math.abs(g)>Math.abs(l)&&e.getGameEvents().emit("SNAKE_DIRECTION_CHANGE",{direction:o.UP}))}}),!0),n.addEventListener("touchcancel",(function(e){e.preventDefault(),t=null}),!0),{SNAKE_ARENA:document.getElementById(a.id),PLAY_BUTTON:u,PAUSE_BUTTON:s,SCORE_BOARD:d}}catch(t){throw e.LOGGER.error("Failed to setup the page: ".concat(t)),t}},onWindowLoad:function(e){var t=e.arenaMaxSize,n=e.arenaId,r=document.getElementById(n),i=Math.floor(r.clientWidth)<t?Math.floor(r.clientWidth):t,a=i+Math.floor(.25*i);return r.setAttribute("width",i),r.setAttribute("height",a),{ARENA_WIDTH:i,ARENA_HEIGHT:a}}}}function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var n=function(){var n,r,i,a,o="play-snake-arena",s=(0,e().onWindowLoad)({arenaMaxSize:500,arenaId:o}),u=s.ARENA_WIDTH,d=s.ARENA_HEIGHT,c={DEFAULT:"Sorry.",SETUP_GAME:"Failed to setup",START_GAME:"Unable To Start The Game",INACTIVITY_TIMEOUT:"It seems you are not playing"},l={x:u-1,y:d-1},g={x:l.x-28,y:l.y-28},h={id:o,width:u,height:d,borderColor:"black",borderWidth:1,limits:l,supportedKeys:[37,38,39,40],arena:{center:{x:Math.floor(u/2),y:Math.floor(d/2)}},directionMap:{37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN"},keyConfig:{37:{reverse:39},38:{reverse:40},39:{reverse:37},40:{reverse:38}},game:{inactivityTimeout:300,state:{paused:0,stopped:1,playing:2}},pauseButton:{id:"pause-play-snake",text:"Pause",order:"0"},resumeButton:{id:"resume-play-snake",text:"Resume",order:"1"},snake:{id:"the-snake",elemType:"circle",width:14,color:"black",length:1,speed:12,step:1,turboSpeed:3},eatables:{basicFood:{id:"the-snake-food",color:"#aba99f",description:"Basic food",showInLegend:!0,points:5,appearDuration:null,startAfter:0,elemType:"circle",size:7,limits:g,isIntervalBased:!1,code:"basicFood",growSnakeIfConsumed:!0,growSnakeByLength:1},bonusFood:{id:"the-snake-bonus-food",color:"#d12308",description:"Bonus point",showInLegend:!0,points:10,appearDuration:10,startAfter:30,elemType:"circle",size:7,limits:g,isIntervalBased:!0,code:"bonusFood",growSnakeIfConsumed:!1,growSnakeByLength:2},speedBonus:{id:"the-speed-bonus",color:"#ffe205",description:"Turbo boost",showInLegend:!0,points:0,appearDuration:10,startAfter:30,elemType:"circle",size:7,speedDuration:10,limits:g,isIntervalBased:!0,code:"speedBonus",growSnakeIfConsumed:!1,growSnakeByLength:0}}},f={},p={RENDER_UNIT:"px",getSvgNamespace:function(){return"http://www.w3.org/2000/svg"},getWindow:function(){return window},getDocument:function(){return this.getWindow().document},getDocumentBody:function(){return this.getDocument().body},windowAlert:function(e){this.getWindow().alert(e)},getConfig:function(){return h},getGame:function(){return n},getDirectionCommands:function(){return r},getSnakeDirectionMap:function(){return f},pixelify:function(e){return String(e).trim().concat(this.RENDER_UNIT)},getStyleString:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.keys(e).reduce((function(t,n){if(!n||!String(n).trim().length)return t;n=String(n).trim();var r=e[n];return String(r).trim().length?(r=String(r).trim(),t.concat(" ".concat(n,": ").concat(r,";"))):t}),"")},createHTMLElement:function(e){var n=e.elementType,r=e.innerHTML,i=e.attributes,a=void 0===i?{}:i,o=e.eventListeners,s=void 0===o?{}:o,u=e.elementNamespace,d=e.parent,c=e.beforeElement;d||(d=p.getDocumentBody());var l=u?this.getDocument().createElementNS(u,n):this.getDocument().createElement(n);return"object"===t(a)&&Object.keys(a).forEach((function(e){return l.setAttribute(e,a[e])})),r&&(l.innerHTML=String(r)),c?d.insertBefore(l,c):d.appendChild(l),"object"===t(s)&&Object.keys(s).forEach((function(e){return l.addEventListener(e,s[e])})),l},getGameEvents:function(){return x},checkBoundaryPosition:function(e,t){var n=this.getConfig(),r=n.borderWidth,i=n.limits,a=this.getConfig().snake.width;switch(e){case 37:t.x<r&&(t.x=i.x-a);break;case 38:t.y<r&&(t.y=i.y-a);break;case 39:t.x+a>i.x&&(t.x=r);break;case 40:t.y+a>i.y&&(t.y=r)}return t},getErrorMessages:function(){return c},LOGGER:{log:console.log,error:console.error,warn:console.warn}};i={id:Date.now(),direction:p.getConfig().supportedKeys[2],position:{x:p.getConfig().arena.center.x,y:p.getConfig().arena.center.y}},a=[],i&&a.push(i),r={add:function(e){var t=a[a.length-1];t&&t.position.x==e.position.x&&t.position.y==e.position.y?t.direction=e.direction:a.push(e)},getFirst:function(){return a[0]},remove:function(){a.shift()},clear:function(){a.splice(0,a.length)},hasCommands:function(){return a.length>0},getNextTurn:function(e){var t=p.getSnakeDirectionMap();if(void 0===t[e])return this.getFirst();var n=a.findIndex((function(n){return n.id===t[e]}));return n==a.length-1?void 0:a[n+1]}};var m,y,v,E,S,b,k,x=function(){var e,t={PAUSE_BUTTON_CLICKED:[function(){e.pause()}],RESUME_BUTTON_CLICKED:[function(){e.resume()}],STOP_GAME:[function(){return e.stop()}],EATABLE_CONSUMED:[function(e){e.hide()},function(e){"number"==typeof e.points&&n("UPDATE_SCORE",e.points)},function(t){e.growSnake(t)}],UPDATE_SCORE:[function(t){e.updateScore(t)}],USE_SPEED_BONUS:[function(){e.increaseSnakeSpeed()}],DEVOURED_SELF:[function(){return n("STOP_GAME")}],SNAKE_DIRECTION_CHANGE:[function(t){var n=t.direction;e.handleSnakeDirectionChange(parseInt(n))}]};function n(e,n){t.hasOwnProperty(e)?t[e].forEach((function(e){return e(n)})):console.warn("Invalid event triggered : ".concat(e))}return{init:function(t){return e=t},emit:n,listen:function(e,n){Array.isArray(t[e])?t[e].push(n):t[e]=[n]},destruct:function(){return t={}}}}(),I=(m=p,y=function(e){var t=e.getConfig(),n=t.snake.width;function r(e,r){var i,a;do{var o=[Math.floor(Math.random()*(e.x-r))+t.borderWidth+1,Math.floor(Math.random()*(e.y-r))+t.borderWidth+1];i=o[0],a=o[1]}while(i%n!=0&&a%n!=0);return{x:i+2,y:a+2}}return{getNextEatablePosition:r,createEatableItem:function(n,i,a,o){if(!t.eatables[o])return e.LOGGER.warn("item ".concat(o," is not configured"));var s,u=t.eatables[o],d=u.id,c=u.limits,l=u.elemType,g=u.color,h=u.size,f=u.isIntervalBased,p=u.startAfter,m=u.points,y=u.appearDuration,v=u.growSnakeIfConsumed,E=u.growSnakeByLength,S=e.createHTMLElement({elementType:l,elementNamespace:e.getSvgNamespace(),attributes:{id:d,cx:i,cy:a,r:h,fill:g},parent:e.getGame().arena,beforeElement:e.getGame().getSnake().head.element}),b=i+(h-1),k=a+(h-1);return{get isIntervalBased(){return f},get element(){return S},get arena(){return n},get limits(){return c},get intervalId(){return s},set intervalId(e){s=e},get startAfter(){return p},get size(){return h},get x2(){return b},set x2(e){b=e},get y2(){return k},set y2(e){k=e},get points(){return parseInt(m)},get x(){return parseInt(this.element.getAttribute("cx"))},set x(e){this.element.setAttribute("cx",Math.floor(e))},get y(){return parseInt(this.element.getAttribute("cy"))},set y(e){this.element.setAttribute("cy",Math.floor(e))},get appearDuration(){return y},get growSnakeIfConsumed(){return v},get growSnakeByLength(){return E},startInterval:function(){var e=this;if(e.isIntervalBased)return e.intervalId=setInterval(e.drop.bind(e),1e3*e.startAfter),e.intervalId},drop:function(){var e=r(this.limits,this.size),t=e.x,n=e.y;this.x=t,this.y=n,"number"==typeof this.appearDuration&&setTimeout(this.hide.bind(this),1e3*this.appearDuration)},hide:function(){this.x=-10,this.y=-10}}}}}(m),v=y.createEatableItem,E=y.getNextEatablePosition,S=function(e){var t=e.getConfig(),n=t.snake,r=n.elemType,i=n.color,a=n.width,o=n.step,s=n.id,u=t.eatables.bonusFood.size,d=t.directionMap;function c(t,n,u,d,c){var l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:i,g=1===c,h="".concat(s,"-part").concat(c),f=a/2,p=n+(f-1),m=u+(f-1),y=e.createHTMLElement({elementNamespace:e.getSvgNamespace(),elementType:r,attributes:{id:h,cx:p,cy:m,r:f,fill:l,width:e.pixelify(a),height:e.pixelify(a)},parent:t}),v=d,E=null,S=null;return{id:h,element:y,color:l,get direction(){return v},set direction(e){v=e},get next(){return E},get prev(){return S},set next(e){E=e},set prev(e){S=e},get x(){return this.getCenter().x-(f-1)},set x(e){y.setAttribute("cx",e+(f-1))},get y(){return this.getCenter().y-(f-1)},set y(e){y.setAttribute("cy",e+(f-1))},get x2(){return this.getCenter().x+(f-1)},get y2(){return this.getCenter().y+(f-1)},get isHead(){return g},isTail:function(){return h===e.getGame().getSnake().tail.id},getCenter:function(){return{x:parseInt(this.element.getAttribute("cx")),y:parseInt(this.element.getAttribute("cy"))}},nextXY:function(){var t=this,n={x:t.x,y:t.y};switch(t.direction){case 37:n.x-=o;break;case 38:n.y-=o;break;case 39:n.x+=o;break;case 40:n.y+=o}e.checkBoundaryPosition(t.direction,n),t.x=n.x,t.y=n.y;var r=e.getDirectionCommands();if(r.hasCommands()){var i=r.getNextTurn(h),a=t.getCenter();i&&i.position.x==a.x&&i.position.y==a.y&&(t.direction=i.direction,e.getSnakeDirectionMap()[h]=i.id,t.isTail()&&r.remove())}}}}return{Snake:function(t,n,r,s,l){var g,h=1,f=i,p=s,m=c(t,n,r,p,h),y=m,v=[m];return{get arena(){return t},set arena(e){t=e},get length(){return h},set length(e){return h=e},get head(){return m},set head(e){return m=e},get tail(){return y},set tail(e){return y=e,this.length+=1,y},get intervalId(){return g},set intervalId(e){g=e},get currentDirection(){return p},set currentDirection(e){p=e},get speed(){return l},set speed(e){l=e},get color(){return f},set color(e){f=e},get bodyParts(){return v},UP:function(){this.move(0,-1*o)},DOWN:function(){this.move(0,o)},RIGHT:function(){this.move(o,0)},LEFT:function(){this.move(-1*o,0)},startSnake:function(e){var t=this;return e="number"==typeof e?e:this.speed,t.intervalId=setInterval((function(){t.changeDirection(t.currentDirection),t.start()}),e),t.intervalId},changeDirection:function(e){this.head.direction="number"==typeof e?e:this.currentDirection},start:function(){this[d[this.head.direction]]()},getPositionOfNewPart:function(){var e=this.tail,t=e.x,n=e.y,r=e.direction,i=[Number(t),Number(n)],o=i[0],s=i[1];switch(r){case 37:o=t+a;break;case 38:s=n+a;break;case 39:o=t-a;break;case 40:s=n-a}return{x:o,y:s}},grow:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=this,r=1;r<=t;r++){var i=n.getPositionOfNewPart(),a=i.x,o=i.y;n.bodyParts.push(c(n.arena,a,o,n.tail.direction,n.length+1));var s=n.bodyParts[n.bodyParts.length-1];n.tail.next=s,s.prev=n.tail,n.tail=s}e.getGame().getBasicFood().drop()},changeColor:function(e){for(var t=this.head;null!==t.next;)n(t,e),t=t.next;function n(e,t){setTimeout((function(){e.color=t}),0)}},isEatingFood:function(){var t=e.getGame().getBasicFood(),n=t.x,r=t.y;return this.head.x<n&&n<this.head.x2&&this.head.y<r&&r<this.head.y2},isEatingBonusFood:function(){var t=this.head,n=e.getGame().getSnakeBonusFood(),r=n.x,i=n.y,a=r+u-1,o=i-u-1,s=i+u-1;return r-u-1<t.x&&t.x<a&&o<t.y&&t.y<s},isEatingSpeedBonus:function(){var t=e.getGame().getSpeedBonusFood(),n=t.x,r=t.y;return this.head.x<n&&n<this.head.x2&&this.head.y<r&&r<this.head.y2},move:function(t,n){if(this.isDevouringSelf())e.getGameEvents().emit("DEVOURED_SELF");else{var r=this.head,i=e.checkBoundaryPosition(r.direction,{x:r.x+t,y:r.y+n}),a=i.x,o=i.y;r.x=a,r.y=o;var s=this.isEatingFood(),u=this.isEatingBonusFood(),d=this.isEatingSpeedBonus();this.moveAllParts(),s?e.getGameEvents().emit("EATABLE_CONSUMED",e.getGame().getBasicFood()):d?(e.getGameEvents().emit("EATABLE_CONSUMED",e.getGame().getSpeedBonusFood()),e.getGameEvents().emit("USE_SPEED_BONUS",e.getGame().getSpeedBonusFood())):u&&e.getGameEvents().emit("EATABLE_CONSUMED",e.getGame().getSnakeBonusFood())}},moveAllParts:function(){1===this.length&&e.getDirectionCommands().clear();for(var t=this.bodyParts,n=0;n<t.length;n++)t[n].isHead||t[n].nextXY()},isDevouringSelf:function(){for(var e=!1,t=this.head.next,n=this.head.direction;null!==t;){if(t.direction!==n||t.id===this.tail.id){switch(n){case 37:this.head.y===t.y&&this.head.x>t.x&&this.head.x<=t.x2&&(e=!0);break;case 38:this.head.x===t.x&&this.head.y>t.y&&this.head.y<=t.y2&&(e=!0);break;case 39:this.head.y===t.y&&this.head.x2<t.x2&&this.head.x2>=t.x&&(e=!0);break;case 40:this.head.x===t.x&&this.head.y2<t.y2&&this.head.y2>=t.y&&(e=!0)}if(e)break}t=t.next}return e}}}}}(m).Snake,b=m.getConfig(),k=e().setupGame,{PlaySnake:function(){var e=k(m),t=e.SNAKE_ARENA,n=e.PLAY_BUTTON,r=e.PAUSE_BUTTON,i=e.SCORE_BOARD;if(!t)throw m.windowAlert(m.getErrorMessages().SETUP_GAME),new Error(m.getErrorMessages().SETUP_GAME);var a,o,s,u,d,c,l=b.game.state.playing,g={playButton:n,pauseButton:r,scoreBoard:i};return{get snake(){return a},set snake(e){a=e},get snakeFood(){return o},set snakeFood(e){o=e},get snakeBonusFood(){return s},set snakeBonusFood(e){s=e},get speedBonus(){return u},set speedBonus(e){u=e},get snakeDirection(){return d},set snakeDirection(e){d=e},get arena(){return t},get state(){return l},set state(e){l=e},showAlert:function(e){m.getWindow().alert(e)},getSnake:function(){var e=this;if(e.snake)return e.snake;var t=m.getDirectionCommands().getFirst(),n=t.direction,r=t.position,i=r.x,a=r.y;return e.snakeDirection=n,e.snake=S(e.arena,i,a,e.snakeDirection,b.snake.speed),e.snake},getSpeedBonusFood:function(){var e=this;return e.speedBonus||(e.speedBonus=v(e.arena,-10,-10,b.eatables.speedBonus.code)),e.speedBonus},getBasicFood:function(){var e=this;if(e.snakeFood)return e.snakeFood;var t=E(b.eatables.basicFood.limits,b.eatables.basicFood.size),n=t.x,r=t.y;return e.snakeFood=v(e.arena,n,r,b.eatables.basicFood.code),e.snakeFood},getSnakeBonusFood:function(){var e=this;return e.snakeBonusFood||(e.snakeBonusFood=v(e.arena,-10,-10,b.eatables.bonusFood.code)),e.snakeBonusFood},start:function(){var e=this;try{e.getSnake().startSnake();var t=e.getBasicFood();setTimeout(1e3*b.eatables.basicFood.startAfter,t),e.getSnakeBonusFood().startInterval(),e.getSpeedBonusFood().startInterval(),e.setButtonListeners()}catch(t){e.showAlert(m.getErrorMessages().START_GAME)}},growSnake:function(e){e&&e.growSnakeIfConsumed&&this.snake&&this.getSnake().grow(e.growSnakeByLength)},pause:function(){var e=this;m.getWindow().clearInterval(e.getSnake().intervalId),m.getWindow().clearInterval(e.getSnakeBonusFood().intervalId),g.pauseButton.setAttribute("disabled","true"),g.playButton.hasAttribute("disabled")&&g.playButton.removeAttribute("disabled"),e.state=b.game.state.paused},resume:function(){var e=this;e.getSnake().startSnake(),e.getSnakeBonusFood().startInterval(),g.playButton.setAttribute("disabled","true"),g.pauseButton.hasAttribute("disabled")&&g.pauseButton.removeAttribute("disabled"),e.state=b.game.state.playing},stop:function(){var e=this;e.state=b.game.state.stopped,[e.getSnake().intervalId,e.getSnakeBonusFood().intervalId,e.getSpeedBonusFood().intervalId].forEach(m.getWindow().clearInterval),[e.getSnake().intervalId,c].forEach(m.getWindow().clearTimeout),e.snake=null,e.snakeFood=null,e.snakeBonusFood=null,e.speedBonus=null,g.pauseButton.setAttribute("disabled",!0),g.playButton.setAttribute("disabled",!0),e.showAlert("GAME OVER\nYou Scored "+e.getScore()+" points.")},manageInactivity:function(){var e=this;void 0!==c&&m.getWindow().clearTimeout(c),c=setTimeout((function(){e.showAlert(m.getErrorMessages().INACTIVITY_TIMEOUT),e.stop()}),1e3*Math.floor(b.game.inactivityTimeout))},handleSnakeDirectionChange:function(e){var t=this;-1!==b.supportedKeys.indexOf(e)&&t.getSnake().currentDirection!=e&&e!=b.keyConfig[String(t.getSnake().currentDirection)].reverse&&(t.snakeDirection=e,t.getSnake().currentDirection=t.snakeDirection,m.getDirectionCommands().add({id:Date.now(),direction:e,position:t.getSnake().head.getCenter()}),t.manageInactivity())},setButtonListeners:function(){m.getWindow().addEventListener("unload",this.stop),m.getDocument().addEventListener("keydown",(function(e){e.preventDefault(),-1!==b.supportedKeys.indexOf(e.keyCode)&&m.getGameEvents().emit("SNAKE_DIRECTION_CHANGE",{direction:e.keyCode})}))},getScore:function(){return parseInt(g.scoreBoard.innerHTML)},updateScore:function(e){return g.scoreBoard.innerHTML=parseInt(g.scoreBoard.innerHTML)+e,parseInt(g.scoreBoard.innerHTML)},increaseSnakeSpeed:function(){var e=this;m.getWindow().clearInterval(this.getSnake().intervalId),this.getSnake().startSnake(b.snake.turboSpeed),setTimeout((function(){m.getWindow().clearInterval(e.getSnake().intervalId),e.getSnake().startSnake(b.snake.speed)}),1e3*b.eatables.speedBonus.speedDuration)}}}}).PlaySnake;n=I(),x.init(n),n.start()};window.onload=function(){n()}})();